<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Range Product Queries of Powers — Structured Notes</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --card: #0b1220;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22d3ee;
      --accent-2: #a78bfa;
      --ok: #34d399;
      --warn: #fbbf24;
      --danger: #fb7185;
      --code-bg: #0b1020;
      --border: #1f2937;
      --shadow: 0 10px 30px rgba(0,0,0,0.45);
      --radius: 14px;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 80% -50%, #18263a 0%, var(--bg) 60%);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.6;
      overflow-y: overlay;
    }
    .container {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 16px 40px;
    }
    .sidebar {
      position: sticky; top: 20px; align-self: start;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid var(--border); border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 16px;
    }
    .sidebar h3 { margin: 0 0 10px; font-size: 16px; color: var(--muted); font-weight: 600; letter-spacing: .3px; }
    .toc { list-style: none; padding: 0; margin: 0; }
    .toc li { margin: 6px 0; }
    .toc a { display: block; text-decoration: none; color: var(--text); padding: 8px 10px; border-radius: 10px; transition: all .15s ease; border: 1px solid transparent; }
    .toc a:hover { background: #0b1220; border-color: var(--border); color: #ffffff; }
    .main { display: flex; flex-direction: column; gap: 18px; }
    .hero { position: relative; background: linear-gradient(180deg, rgba(167,139,250,0.10), rgba(34,211,238,0.06)); border: 1px solid var(--border); border-radius: var(--radius); padding: 26px 22px; box-shadow: var(--shadow); overflow: hidden; }
    .hero:after { content: ""; position: absolute; top: -40px; right: -60px; width: 220px; height: 220px; background: radial-gradient(120px 120px at 60% 40%, rgba(34,211,238,.35), rgba(34,211,238,0) 70%); filter: blur(6px); pointer-events: none; }
    .title { margin: 0; font-size: 28px; letter-spacing: .2px; }
    .subtitle { margin: 6px 0 0; color: var(--muted); }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .chip { padding: 4px 8px; border: 1px solid var(--border); background: #0b1220; border-radius: 999px; color: var(--muted); font-size: 12px; }
    section.card { background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.015)); border: 1px solid var(--border); border-radius: var(--radius); padding: 18px 18px; box-shadow: var(--shadow); }
    h2 { margin: 0 0 10px; font-size: 20px; }
    h3 { margin: 16px 0 8px; font-size: 16px; color: var(--accent-2); }
    p { margin: 8px 0; }
    ul { margin: 8px 0 8px 18px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .note { color: var(--muted); font-size: 14px; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; background: #0b1220; border: 1px solid var(--border); color: var(--text); font-size: 13px; }
    .pill b { color: var(--accent); }
    details { border: 1px solid var(--border); border-radius: 12px; background: #0b1220; }
    summary { list-style: none; cursor: pointer; padding: 12px 14px; font-weight: 600; color: #dbeafe; border-bottom: 1px solid var(--border); user-select: none; }
    summary::-webkit-details-marker { display:none; }
    .details-body { padding: 12px 14px; color: var(--text); }
    table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 12px; }
    th, td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
    th { text-align: left; color: #c7d2fe; font-weight: 600; background: rgba(167,139,250,0.08); }
    tr:last-child td { border-bottom: none; }
    pre, code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 12px; padding: 12px; overflow: auto; }
    code { background: rgba(255,255,255,0.03); padding: 2px 6px; border-radius: 6px; border: 1px solid var(--border); color: #e2e8f0; }
    .callout { border-left: 3px solid var(--accent); background: linear-gradient(90deg, rgba(34,211,238,0.07), rgba(34,211,238,0.02)); padding: 10px 12px; border-radius: 10px; margin: 10px 0; }
    .formula { background: #0b1220; border: 1px dashed #1f334d; padding: 10px 12px; border-radius: 10px; }
    .footer-note { color: var(--muted); font-size: 13px; text-align: center; margin-top: 10px; }
    @media (max-width: 960px) { .container { grid-template-columns: 1fr; } .sidebar { position: static; order: -1; } }

    /* Quiz helpers */
    .quiz { display: grid; gap: 12px; }
    .quiz .q { border: 1px solid var(--border); border-radius: 12px; background: #0b1220; padding: 12px; }
    .quiz .choice { display: block; margin: 6px 0; }
    .quiz .ans { display: none; margin-top: 8px; color: var(--ok); }
    .quiz .reveal { margin-top: 8px; }
    .quiz button { background: #0b1220; color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 6px 10px; cursor: pointer; }
    .quiz button:hover { border-color: var(--accent); color: #ffffff; }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h3>On this page</h3>
      <ul class="toc">
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#example">Example & Breakdown</a></li>
        <li><a href="#brute">Brute-Force Baseline</a></li>
        <li><a href="#two-pass">Precomputation Insight</a></li>
        <li><a href="#single-pass">End-to-End Algorithm</a></li>
        <li><a href="#dry-run">Dry Run</a></li>
        <li><a href="#pseudocode">Pseudocode & Implementations</a></li>
        <li><a href="#conclusion">Conclusion + Quiz</a></li>
      </ul>
    </aside>

    <main class="main">
      <header class="hero">
        <h1 class="title">LeetCode 2438 — Range Product Queries of Powers</h1>
        <p class="subtitle">Derive powers of two from an integer, then answer many range-product queries efficiently using precomputation and modular arithmetic.</p>
        <div class="chips">
          <span class="chip">Bit Manipulation</span>
          <span class="chip">Precomputation</span>
          <span class="chip">Binary</span>
          <span class="chip">Modulo</span>
          <span class="chip">Arrays</span>
        </div>
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="pill"><b>Reading time:</b> ~10 min</span>
          <span class="pill"><b>Keywords:</b> powers of two, binary representation, range product, precompute, 1e9+7</span>
        </div>
      </header>

      <section id="intro" class="card">
        <h2>Introduction</h2>
        <p>Given a positive integer <code>n</code>, form a 0-indexed array <code>powers</code> containing the powers of two that sum to <code>n</code>, sorted in non-decreasing order. For each query <code>[left, right]</code>, return the product of <code>powers[left..right]</code> modulo <code>10^9 + 7</code>.</p>

        <h3>Summary</h3>
        <ul>
          <li>Extract <code>powers</code> by reading the set bits of <code>n</code> in binary; include <code>2^k</code> whenever bit <code>k</code> is 1.</li>
          <li>The array <code>powers</code> has length at most <code>⌊log2(n)⌋ + 1</code> and is inherently sorted ascending.</li>
          <li>Answer many queries quickly by precomputing all subarray products modulo <code>10^9 + 7</code>.</li>
          <li>Overall complexity: build <code>powers</code> in <code>O(log n)</code>; precompute in <code>O((log n)^2)</code>; each query in <code>O(1)</code>.</li>
          <li>Alternative view: products of powers of two correspond to <code>2</code> raised to the sum of exponents.</li>
        </ul>
      </section>

      <section id="example" class="card">
        <h2>Example & Breakdown</h2>
        <p>Example: <code>n = 15</code> ⇒ binary <code>1111</code> ⇒ <code>powers = [1, 2, 4, 8]</code>.</p>
        <ul>
          <li>Queries: <code>[[0,1], [2,2], [0,3]]</code></li>
          <li><code>[0,1]</code> ⇒ <code>1 × 2 = 2</code></li>
          <li><code>[2,2]</code> ⇒ <code>4</code></li>
          <li><code>[0,3]</code> ⇒ <code>1 × 2 × 4 × 8 = 64</code></li>
        </ul>
        <div class="callout">Core idea: the set bits of <code>n</code> pinpoint exactly which powers of two appear in <code>powers</code>, in increasing order.</div>
      </section>

      <section id="brute" class="card">
        <h2>Brute-Force Baseline</h2>
        <ul>
          <li>For each query <code>[L, R]</code>, multiply <code>powers[L] … powers[R]</code> with modulo.</li>
          <li>Time per query: <code>O(R-L+1)</code>; total can be high for many queries.</li>
          <li>Observation: <code>powers.length</code> is small (≤ ~30 for typical <code>n</code> ≤ 1e9), enabling stronger precomputation.</li>
        </ul>
      </section>

      <section id="two-pass" class="card">
        <h2>Precomputation Insight</h2>
        <p>Let <code>m = powers.length</code>. The number of distinct subarrays is <code>m(m+1)/2</code>, which is at most about 465 when <code>m ≤ 30</code>.</p>
        <ul>
          <li>When the number of queries is large, but <code>m</code> is small, precomputing all subarray products pays off.</li>
          <li>Store <code>res[i][j] = product(powers[i..j]) mod M</code> for all <code>0 ≤ i ≤ j &lt; m</code>.</li>
          <li>Each query becomes an <code>O(1)</code> lookup.</li>
        </ul>
        <div class="formula">
          For powers of two, <code>powers[k] = 2^{e_k}</code> with <code>e_k</code> distinct and increasing. Then:<br/>
          <code>∏(k=L..R) powers[k] = 2^{ ∑(k=L..R) e_k }</code> mod M.
        </div>
      </section>

      <section id="single-pass" class="card">
        <h2>End-to-End Algorithm</h2>
        <ul>
          <li><b>Build powers</b>: scan bits of <code>n</code> from least to most significant. For each set bit, push current power <code>p</code>; then double <code>p</code>.</li>
          <li><b>Precompute table</b>: for each start <code>i</code>, expand to <code>j ≥ i</code> with a rolling product, storing <code>res[i][j]</code>.</li>
          <li><b>Answer queries</b>: return <code>res[L][R]</code> for each pair <code>[L, R]</code>.</li>
          <li><b>Modulo</b>: use <code>M = 1,000,000,007</code> to control growth.</li>
        </ul>
        <p class="note">Because <code>m</code> is small, the <code>O(m^2)</code> table is inexpensive and makes queries instant.</p>
      </section>

      <section id="dry-run" class="card">
        <h2>Dry Run</h2>
        <p>Input: <code>n = 10</code> ⇒ binary <code>1010</code> ⇒ <code>powers = [2, 8]</code>.</p>
        <div class="details-body">
          <ul>
            <li>Precompute: <code>res[0][0] = 2</code>, <code>res[0][1] = 2×8 = 16</code>, <code>res[1][1] = 8</code>.</li>
            <li>Queries:
              <ul>
                <li><code>[0,0]</code> ⇒ <code>2</code></li>
                <li><code>[1,1]</code> ⇒ <code>8</code></li>
                <li><code>[0,1]</code> ⇒ <code>16</code></li>
              </ul>
            </li>
            <li>All results taken modulo <code>10^9 + 7</code> (unchanged here).</li>
          </ul>
        </div>
        <div class="callout"><b>Edge cases:</b> If <code>n</code> is a pure power of two, then <code>powers</code> has length 1 and queries are trivial. For very large products, frequent modulo reduces overflow risk.</div>
      </section>

      <section id="pseudocode" class="card">
        <h2>Pseudocode & Implementations</h2>
        <pre><code class="language-text">function buildPowers(n):
    powers = empty list
    p = 1           # 2^0
    while n &gt; 0:
        if (n &amp; 1) == 1:
            append p to powers
        n = n &gt;&gt; 1
        p = p &lt;&lt; 1   # next power of two
    return powers   # ascending

function precomputeProducts(powers, M):
    m = length(powers)
    res = 2D array m x m
    for i in 0..m-1:
        curr = 1
        for j in i..m-1:
            curr = (curr * powers[j]) mod M
            res[i][j] = curr
    return res

function answerQueries(powers, queries):
    M = 1_000_000_007
    res = precomputeProducts(powers, M)
    out = new list
    for [L, R] in queries:
        out.append(res[L][R])
    return out
</code></pre>

        <h3>C++ Implementation</h3>
        <pre><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;

static const long long MOD = 1'000'000'007LL;

vector&lt;long long&gt; rangeProductPowers(long long n, const vector&lt;array&lt;int,2&gt;&gt;&amp; queries) {
    // 1) Build powers from set bits
    vector&lt;long long&gt; powers;
    long long p = 1; // 2^0
    long long x = n;
    while (x &gt; 0) {
        if (x &amp; 1LL) powers.push_back(p);
        x &gt;&gt;= 1LL;
        p &lt;&lt;= 1LL;
    }
    // 2) Precompute all subarray products
    int m = static_cast&lt;int&gt;(powers.size());
    vector&lt;vector&lt;long long&gt;&gt; table(m, vector&lt;long long&gt;(m, 1));
    for (int i = 0; i &lt; m; ++i) {
        long long curr = 1;
        for (int j = i; j &lt; m; ++j) {
            curr = (curr * (powers[j] % MOD)) % MOD;
            table[i][j] = curr;
        }
    }
    // 3) Answer queries in O(1)
    vector&lt;long long&gt; ans;
    ans.reserve(queries.size());
    for (auto qr : queries) {
        int L = qr[0], R = qr[1];
        ans.push_back(table[L][R]);
    }
    return ans;
}
</code></pre>

        <h3>Java Implementation</h3>
        <pre><code class="language-java">import java.util.*;

class Solution {
    static final long MOD = 1_000_000_007L;

    public int[] productQueries(int n, int[][] queries) {
        // 1) Build powers from set bits of n
        List&lt;Long&gt; powers = new ArrayList&lt;&gt;();
        long p = 1; // 2^0
        int x = n;
        while (x &gt; 0) {
            if ((x &amp; 1) == 1) powers.add(p);
            x &gt;&gt;= 1;
            p &lt;&lt;= 1;
        }

        int m = powers.size();
        // 2) Precompute all subarray products
        long[][] res = new long[m][m];
        for (int i = 0; i &lt; m; i++) {
            long curr = 1;
            for (int j = i; j &lt; m; j++) {
                curr = (curr * (powers.get(j) % MOD)) % MOD;
                res[i][j] = curr;
            }
        }

        // 3) Answer queries in O(1)
        int[] out = new int[queries.length];
        for (int qi = 0; qi &lt; queries.length; qi++) {
            int L = queries[qi][0], R = queries[qi][1];
            out[qi] = (int)(res[L][R] % MOD);
        }
        return out;
    }
}
</code></pre>

        <h3>Complexity</h3>
        <ul>
          <li><b>Time:</b> <code>O(log n)</code> to build <code>powers</code>; <code>O(m^2)</code> to precompute, where <code>m = powers.length ≤ ⌊log2(n)⌋+1</code>; <code>O(1)</code> per query.</li>
          <li><b>Space:</b> <code>O(m^2)</code> for the table plus <code>O(m)</code> for <code>powers</code>.</li>
        </ul>
      </section>

      <section id="conclusion" class="card">
        <h2>Conclusion</h2>
        <ul>
          <li>Form <code>powers</code> directly from the set bits of <code>n</code>, in ascending order.</li>
          <li>Exploit small <code>m</code> to precompute all subarray products modulo <code>10^9 + 7</code>.</li>
          <li>Turn each range product query into an <code>O(1)</code> lookup.</li>
          <li>Scales well for large numbers of queries.</li>
        </ul>

        <h3>Interactive Quiz</h3>
        <div class="quiz" id="quiz">
          <!-- Q1 MCQ -->
          <div class="q">
            <div><b>1) How is the array powers constructed from n?</b></div>
            <label class="choice"><input type="radio" name="q1"> By listing all integers from 1 to n</label>
            <label class="choice"><input type="radio" name="q1"> By collecting 2^k for each set bit k in n's binary form</label>
            <label class="choice"><input type="radio" name="q1"> By sorting the digits of n</label>
            <label class="choice"><input type="radio" name="q1"> By prime factorization</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">By collecting 2^k for each set bit k in n's binary form.</div></details>
          </div>

          <!-- Q2 MCQ -->
          <div class="q">
            <div><b>2) What is the maximum possible length of powers for typical constraints?</b></div>
            <label class="choice"><input type="radio" name="q2"> n</label>
            <label class="choice"><input type="radio" name="q2"> sqrt(n)</label>
            <label class="choice"><input type="radio" name="q2"> O(log2 n)</label>
            <label class="choice"><input type="radio" name="q2"> Constant 2</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">O(log2 n).</div></details>
          </div>

          <!-- Q3 SA -->
          <div class="q">
            <div><b>3) Short answer:</b> For n = 15, write the powers array.</div>
            <button data-target="a3">Reveal answer</button>
            <div id="a3" class="ans">[1, 2, 4, 8]</div>
          </div>

          <!-- Q4 MCQ -->
          <div class="q">
            <div><b>4) Why is precomputation effective here?</b></div>
            <label class="choice"><input type="radio" name="q4"> Because queries are few</label>
            <label class="choice"><input type="radio" name="q4"> Because powers is long</label>
            <label class="choice"><input type="radio" name="q4"> Because powers is short while queries can be many</label>
            <label class="choice"><input type="radio" name="q4"> Because modulo is unnecessary</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">Because powers is short while queries can be many.</div></details>
          </div>

          <!-- Q5 SA -->
          <div class="q">
            <div><b>5) Short answer:</b> What value of M (modulo) is used?</div>
            <button data-target="a5">Reveal answer</button>
            <div id="a5" class="ans">1,000,000,007</div>
          </div>

          <!-- Q6 MCQ -->
          <div class="q">
            <div><b>6) What does res[i][j] store?</b></div>
            <label class="choice"><input type="radio" name="q6"> Sum of powers[i..j]</label>
            <label class="choice"><input type="radio" name="q6"> Product of powers[i..j] modulo M</label>
            <label class="choice"><input type="radio" name="q6"> Maximum over powers[i..j]</label>
            <label class="choice"><input type="radio" name="q6"> Count of set bits in n</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">Product of powers[i..j] modulo M.</div></details>
          </div>

          <!-- Q7 SA -->
          <div class="q">
            <div><b>7) Short answer:</b> For powers = [1, 2, 4, 8], what is the result of query [0,3]?</div>
            <button data-target="a7">Reveal answer</button>
            <div id="a7" class="ans">64</div>
          </div>

          <!-- Q8 MCQ -->
          <div class="q">
            <div><b>8) Time per query after precomputation is:</b></div>
            <label class="choice"><input type="radio" name="q8"> O(m)</label>
            <label class="choice"><input type="radio" name="q8"> O(log n)</label>
            <label class="choice"><input type="radio" name="q8"> O(1)</label>
            <label class="choice"><input type="radio" name="q8"> O(n)</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">O(1).</div></details>
          </div>

          <!-- Q9 SA -->
          <div class="q">
            <div><b>9) Short answer:</b> Which binary operation reveals whether to include the current power when building powers?</div>
            <button data-target="a9">Reveal answer</button>
            <div id="a9" class="ans">Check if (n &amp; 1) == 1</div>
          </div>

          <!-- Q10 MCQ -->
          <div class="q">
            <div><b>10) What is the overall precomputation time in terms of m = powers.length?</b></div>
            <label class="choice"><input type="radio" name="q10"> O(m)</label>
            <label class="choice"><input type="radio" name="q10"> O(m log m)</label>
            <label class="choice"><input type="radio" name="q10"> O(m^2)</label>
            <label class="choice"><input type="radio" name="q10"> O(1)</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">O(m^2).</div></details>
          </div>

          <!-- Q11 SA -->
          <div class="q">
            <div><b>11) Short answer:</b> For n = 10, list powers and the product for query [0,1].</div>
            <button data-target="a11">Reveal answer</button>
            <div id="a11" class="ans">powers = [2, 8]; product = 16</div>
          </div>

          <!-- Q12 MCQ -->
          <div class="q">
            <div><b>12) Which statement is true about the order of the powers array?</b></div>
            <label class="choice"><input type="radio" name="q12"> It is arbitrary</label>
            <label class="choice"><input type="radio" name="q12"> It is strictly decreasing</label>
            <label class="choice"><input type="radio" name="q12"> It is non-decreasing (ascending)</label>
            <label class="choice"><input type="radio" name="q12"> It depends on the queries</label>
            <details class="reveal"><summary>Show answer</summary><div class="details-body">It is non-decreasing (ascending).</div></details>
          </div>
        </div>
      </section>

      <div class="footer-note">Optimized for quick revision. 🚀</div>
    </main>
  </div>

  <script>
    // Simple toggle for short-answer reveal buttons
    (function () {
      document.querySelectorAll('.quiz button[data-target]').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var id = btn.getAttribute('data-target');
          var ans = document.getElementById(id);
          if (!ans) return;
          var visible = ans.style.display === 'block';
          ans.style.display = visible ? 'none' : 'block';
          btn.textContent = visible ? 'Reveal answer' : 'Hide answer';
        });
      });
    })();
  </script>
</body>
</html>